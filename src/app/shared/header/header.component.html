<!-- Contenedor Principal del Header -->
<div
  class="min-h-16 w-full font-serif relative overflow-hidden header-mystical-bg"
>
  <!-- Fondo Animado con Estrellas -->
  <div class="fixed inset-0 pointer-events-none z-0">
    <!-- Estrellas Grandes -->
    <div
      class="star large"
      style="top: 8%; left: 12%; animation-delay: 0s"
    ></div>
    <div
      class="star large"
      style="top: 15%; left: 88%; animation-delay: 1.2s"
    ></div>
    <div
      class="star large"
      style="top: 25%; left: 5%; animation-delay: 2.1s"
    ></div>
    <div
      class="star large"
      style="top: 35%; left: 85%; animation-delay: 1.8s"
    ></div>
    <div
      class="star large"
      style="top: 55%; left: 15%; animation-delay: 2.8s"
    ></div>
    <div
      class="star large"
      style="top: 75%; left: 90%; animation-delay: 1.5s"
    ></div>

    <!-- Estrellas Medianas -->
    <div
      class="star medium"
      style="top: 12%; left: 45%; animation-delay: 0.8s"
    ></div>
    <div
      class="star medium"
      style="top: 18%; left: 65%; animation-delay: 2.2s"
    ></div>
    <div
      class="star medium"
      style="top: 28%; left: 32%; animation-delay: 1.1s"
    ></div>
    <div
      class="star medium"
      style="top: 38%; left: 72%; animation-delay: 3s"
    ></div>

    <!-- Estrellas Pequeñas -->
    <div
      class="star small"
      style="top: 6%; left: 25%; animation-delay: 1.4s"
    ></div>
    <div
      class="star small"
      style="top: 22%; left: 78%; animation-delay: 2.9s"
    ></div>
    <div
      class="star small"
      style="top: 42%; left: 8%; animation-delay: 0.3s"
    ></div>

    <!-- Destellos -->
    <div
      class="sparkle"
      style="top: 10%; left: 55%; animation-delay: 0.6s"
    ></div>
    <div
      class="sparkle"
      style="top: 30%; left: 85%; animation-delay: 2.4s"
    ></div>
    <div
      class="sparkle"
      style="top: 50%; left: 45%; animation-delay: 1.2s"
    ></div>
  </div>

  <!-- Gradiente Místico -->
  <div class="fixed inset-0 pointer-events-none z-1">
    <div class="mystical-gradient"></div>
  </div>

  <!-- Contenido Principal del Header -->
  <header
    class="header-mystical-container"
    [ngClass]="{ 'mobile-layout': isMobile }"
    style="border: 2px solid #423b51 !important"
  >
    <!-- DISEÑO PARA ESCRITORIO -->
    <ng-container *ngIf="!isMobile">
      <!-- Sección de Búsqueda -->
      <div class="search-mystical-section">
        <form
          class="search-mystical-form group"
          (submit)="onSearch($event)"
          role="search"
          aria-label="Buscar contenido místico"
        >
          <div class="search-input-container">
            <!-- Icono de Búsqueda -->
            <div class="search-icon-wrapper">
              <div class="mystical-search-icon-container">
                <i class="fas fa-search mystical-search-icon"></i>
                <div class="search-icon-glow"></div>
                <div class="search-icon-particles">
                  <div class="search-particle sp-1"></div>
                  <div class="search-particle sp-2"></div>
                </div>
              </div>
            </div>

            <!-- Campo de Búsqueda -->
            <input
              type="search"
              [(ngModel)]="searchQuery"
              name="search"
              placeholder="Buscar..."
              class="search-mystical-input"
              autocomplete="off"
              (input)="onSearchInput()"
            />

            <!-- Efectos Visuales del Input -->
            <div class="input-border"></div>
            <div class="input-glow"></div>

            <!-- Atajo de Teclado -->
            <div class="search-shortcut-mystical">
              <div class="shortcut-icon-wrapper">
                <i class="fas fa-magic shortcut-magic-icon"></i>
                <div class="shortcut-magic-glow"></div>
              </div>
              <kbd>⌘</kbd>
              <kbd>K</kbd>
            </div>
          </div>
        </form>
      </div>

      <!-- Botones de Acción y Perfil de Usuario -->
      <div class="actions-mystical-section">
        <!-- Botón de Mensajes -->
        <button
          class="action-btn-elegant messages-btn group"
          (click)="onMessagesClick()"
          [attr.aria-label]="'Mensajes (' + messageCount + ' nuevos)'"
        >
          <div class="icon-elegant-wrapper">
            <i class="fas fa-envelope icon-elegant"></i>
            <div class="icon-elegant-glow"></div>
          </div>
          <span
            *ngIf="messageCount > 0"
            class="badge-elegant messages-badge-elegant"
          >
            {{ messageCount > 99 ? "99+" : messageCount }}
          </span>
        </button>

        <!-- Botón de Notificaciones -->
        <button
          class="action-btn-elegant notifications-btn group"
          (click)="onNotificationsClick()"
          [attr.aria-label]="
            'Notificaciones (' + notificationCount + ' nuevas)'
          "
        >
          <div class="icon-elegant-wrapper">
            <i class="fas fa-bell icon-elegant"></i>
            <div class="icon-elegant-glow"></div>
          </div>
          <span
            *ngIf="notificationCount > 0"
            class="badge-elegant notifications-badge-elegant"
          >
            {{ notificationCount > 99 ? "99+" : notificationCount }}
          </span>
        </button>

        <!-- Perfil de Usuario -->
        <div class="user-mystical-profile group">
          <!-- Efectos de Destellos del Perfil -->
          <div class="profile-sparkles-professional">
            <i class="fas fa-sparkles profile-sparkle-1"></i>
            <i class="fas fa-star profile-sparkle-2"></i>
            <div class="profile-sparkle-trail ps-trail-1"></div>
            <div class="profile-sparkle-trail ps-trail-2"></div>
          </div>

          <!-- Avatar del Usuario -->
          <div class="avatar-mystical-container">
            <div class="avatar-mystical-frame">
              <div class="avatar-inner-glow"></div>
              <div class="avatar-outer-glow"></div>
              <div class="online-status-mystical">
                <div class="status-dot"></div>
                <div class="status-pulse"></div>
              </div>
            </div>
          </div>

          <!-- Información del Usuario -->
          <div class="user-info-mystical">
            <span class="user-name-mystical">{{ userProfile.name }}</span>
            <span class="user-email-mystical">{{ userProfile.email }}</span>
          </div>

          <!-- Flecha del Dropdown -->
          <div class="dropdown-arrow-mystical">
            <i class="fas fa-chevron-down arrow-mystical-icon"></i>
            <div class="arrow-mystical-glow"></div>
          </div>

          <!-- Menú Desplegable del Usuario -->
          <div class="profile-dropdown-mystical">
            <!-- Efectos de Fondo del Dropdown -->
            <div class="dropdown-bg-effects">
              <div class="dropdown-particle dp-1"></div>
              <div class="dropdown-particle dp-2"></div>
              <div class="dropdown-particle dp-3"></div>
            </div>

            <!-- Contenido del Dropdown -->
            <div class="dropdown-content-mystical">
              <!-- Información del Usuario en Dropdown -->
              <div class="dropdown-user-section">
                <div class="dropdown-avatar-small">
                  <div class="dropdown-avatar-glow"></div>
                </div>
                <div class="dropdown-user-info">
                  <span class="dropdown-user-name">{{ userProfile.name }}</span>
                  <span class="dropdown-user-email">{{
                    userProfile.email
                  }}</span>
                </div>
              </div>

              <!-- Separador -->
              <div class="dropdown-divider">
                <div class="divider-line"></div>
                <div class="divider-sparkle">
                  <i class="fas fa-sparkles"></i>
                </div>
              </div>

              <!-- Opciones del Menú -->
              <div class="dropdown-menu-options">
                <button class="dropdown-option" (click)="onEditProfile()">
                  <div class="option-icon-wrapper">
                    <i class="fas fa-user-edit option-icon"></i>
                    <div class="option-icon-glow"></div>
                  </div>
                  <span class="option-text">Editar Perfil</span>
                  <i class="fas fa-chevron-right option-arrow"></i>
                </button>

                <button class="dropdown-option" (click)="onChangePassword()">
                  <div class="option-icon-wrapper">
                    <i class="fas fa-key option-icon"></i>
                    <div class="option-icon-glow"></div>
                  </div>
                  <span class="option-text">Cambiar Contraseña</span>
                  <i class="fas fa-chevron-right option-arrow"></i>
                </button>

                <button class="dropdown-option" (click)="onSettings()">
                  <div class="option-icon-wrapper">
                    <i class="fas fa-cog option-icon"></i>
                    <div class="option-icon-glow"></div>
                  </div>
                  <span class="option-text">Configuración</span>
                  <i class="fas fa-chevron-right option-arrow"></i>
                </button>

                <button class="dropdown-option" (click)="onSubscription()">
                  <div class="option-icon-wrapper">
                    <i class="fas fa-crown option-icon"></i>
                    <div class="option-icon-glow"></div>
                  </div>
                  <span class="option-text">Mi Suscripción</span>
                  <i class="fas fa-chevron-right option-arrow"></i>
                </button>

                <button class="dropdown-option" (click)="onHelp()">
                  <div class="option-icon-wrapper">
                    <i class="fas fa-question-circle option-icon"></i>
                    <div class="option-icon-glow"></div>
                  </div>
                  <span class="option-text">Ayuda y Soporte</span>
                  <i class="fas fa-chevron-right option-arrow"></i>
                </button>

                <!-- Separador antes del Logout -->
                <div class="dropdown-divider-simple">
                  <div class="divider-line-simple"></div>
                </div>

                <!-- Opción de Cerrar Sesión -->
                <button
                  class="dropdown-option logout-option"
                  (click)="onLogout()"
                >
                  <div class="option-icon-wrapper">
                    <i class="fas fa-sign-out-alt option-icon"></i>
                    <div class="option-icon-glow logout-glow"></div>
                  </div>
                  <span class="option-text">Cerrar Sesión</span>
                  <i class="fas fa-chevron-right option-arrow"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- DISEÑO PARA MÓVIL -->
    <ng-container *ngIf="isMobile">
      <!-- Contenedor del Header Móvil -->
      <div class="mobile-header-container">
        <!-- Logo/Marca a la Izquierda -->
        <div class="mobile-brand-left">
          <div class="mobile-logo">
            <img
              [src]="logoUrl"
              alt="Arcana logo"
              class="mobile-logo-image"
              (error)="onLogoError($event)"
            />
            <span class="mobile-brand-text">Arcana</span>
          </div>
        </div>

        <!-- Acciones Móviles a la Derecha -->
        <div class="mobile-actions-right">
          <!-- Contenedor de Búsqueda Móvil -->
          <div
            class="mobile-search-container"
            [ngClass]="{ expanded: isSearchExpanded }"
          >
            <!-- Campo de Búsqueda Expandible -->
            <div
              *ngIf="isSearchExpanded"
              class="mobile-search-input-container"
              appClickOutside
              (clickOutside)="onSearchExpandedClickOutside()"
            >
              <input
                type="search"
                [(ngModel)]="searchQuery"
                name="search"
                placeholder="Buscar en Arcana..."
                class="mobile-search-input-field"
                autocomplete="off"
                (input)="onSearchInput()"
                #mobileSearchInput
              />
            </div>

            <!-- Botón de Búsqueda Móvil -->
            <button
              class="mobile-search-btn"
              [ngClass]="{ expanded: isSearchExpanded }"
              (click)="onMobileSearchClick()"
              aria-label="Buscar"
            >
              <div class="mobile-search-icon-wrapper">
                <i class="fas fa-search mobile-search-icon"></i>
                <div class="mobile-search-icon-glow"></div>
              </div>
            </button>
          </div>

          <!-- Botón de Notificaciones Móvil -->
          <button
            class="mobile-action-btn notifications-btn"
            (click)="onNotificationsClick()"
            [attr.aria-label]="
              'Notificaciones (' + notificationCount + ' nuevas)'
            "
          >
            <div class="mobile-icon-wrapper">
              <i class="fas fa-bell mobile-icon"></i>
              <div class="mobile-icon-glow"></div>
            </div>
            <span
              *ngIf="notificationCount > 0"
              class="mobile-badge notifications-badge-elegant"
            >
              {{ notificationCount > 99 ? "99+" : notificationCount }}
            </span>
          </button>
        </div>
      </div>
    </ng-container>
  </header>
</div>
